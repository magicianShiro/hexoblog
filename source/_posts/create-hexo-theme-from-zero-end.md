---
title: 从零开始创建一个hexo主题-end
tags: hexo主题
categories: 技术
banner: //image.movom.cc/blog/page/create-hexo-theme-from-zero-end.jpeg
date: 2018-02-03 22:52:43
---

正如大家所见，这个系列被我坑掉了。我真不是有意的，主要是遇到了几点不可抗力，后面会给大家缓缓道来。
那为什么我要写这篇文章呢，是因为这个主题是我魔改的，为了改他，几乎源码都被我玩弄了一番。其中遇到的一些鬼东西跟大家伙分享一样。（~~主要是不记录一下自己就给忘了~~）

<!-- more -->
> 正所谓胜败乃兵家常事，但是懒！就不是了 ----by 鲁迅
> 随你们吧 反正什么都是我说的 ----by 鲁迅

# 闲谈趣事
> 以下内容真的只是闲谈，想要看干货的直就直接进入[正文](#正文)

我先说说我遇到了写什么问题
  1. 本来说好的我是想用`pug + stylus`，但是实际上并不是。起初我是用的pug，但是不知道我修改主题一点代码都需要重启一下hexo的服务器，我没有去研究是否是我少安装了东西。

  2. 我写着写着，反正难的不是排版和布局，是自己真的不知道要写成什么样。不过我这个主题改好之后倒是觉得，简简单单的纯文字倒也挺好的。像 `egoist` 大佬那样的blog貌似也不错。 

  3. 我又写着写着，发现自己好像需要写一套md样式，这就有点头疼了。。感觉工作量挺大的有点得不偿失的样子。

以上就是我主要遇到的一些问题

后来某位萌萌的大佬（[u3u](https://github.com/u3u)），指导过我几次问题之后，我随手翻到了他的blog。哇这人好萌啊。我不禁发出这样的感慨。。然后就打算用他的主题好了。

可是呢 我想到我貌似开了个坑，要不魔改魔改。。也好有个交代。。然后现在这个魔改的东西救出来了。

其实改动也挺多的，只是可能不是样式方面，有的地方看不到而已。样式方面有略有改动，后期可能继续会修改一些内容。

接下来说说我从中学到的东西，对大家有没有用就看各位了。

# 正文
## 我看还是先来看看坑
1. 首先其实我之前写主题的时候使用`is_current`方法，他无法得到我想要的结果，例如`is_current(/)`在首页的时候得不到我想要的`true`, 后来呢。我就给`hexo` pr了。这个问题已经得到了解决

2. 其实还是标签页，分类页不显示的问题。这个问题稍后会详细的说明。

3. 部署的时候，由于我用的还是我室友的电脑，他的`git`全局配置导致我部署到`github`上时，`name`和`email`都出错了。翻了源码之后弄明白了。后面再说是怎么回事

## 标签页问题
让我们首先来了解一个东西
我们在`source`文件夹下其实是可以任意定义文件夹的，并不局限于
  1. `_drafts`草稿（命令： hexo new drafts xxx）
  2. `_posts`文章（命令：hexo new xxx）
  3. `tags`标签页（命令：hexo new page tags）
  4. 其实其他的你都能用 hexo new page xxx 来创建的。。。

了解了以上内容之后， 我们再来了解一个内容
主题中会有一个 `<%- body %>`， 这玩意是用来匹配文章内容的，那么到底是怎么样匹配的呢？
  1. `url: /` 匹配到的是`index.ejs`文件
  2. `url: permalink` permalink指的是在配置文件中配置的玩意  匹配到的是 `post.ejs`
  3. `url: /archive` 匹配到的是`archive.ejs`文件
  4. `url: /tags/:tagname` 匹配到的是`tag.ejs`文件
  5. `url: /:else` 匹配不到上述页面时候并且找不到`layout`时匹配的页面 匹配到的是`page.ejs`文件

仔细看这个这个`tags`的路径 他后面带有一个 `:tagname` 这个`tagname`就是每个标签具体的名字了，而且这个参数是必须的，也就是说 如果你只是想用路径 `/tags` 来进入你所有标签的页面，这种在默认行为里面是不存在的。如果你这么做了，那么就会直接匹配到 `/:else`。 也就是主题的page.ejs里面写的啥，就会显示啥。

但是相信大多数人可能都用过`next`主题，`next`主题明明就有所有标签的页面啊。没错，我也这么想了，于是我就点进了`next`的源码看了一下，结果发现它展示所有标签的代码是写在 `post.ejs`引入的子页面中的，而`page.ejs`引入的和`post.ejs`一样的。。

但是我觉得这样依旧不合理，于是查了查。最终发现还是`layout`这个东西的问题，之前都没有太注意过他

我虽然没看`hexo`具体是怎么做的，但是我感觉当你的路径是`/tags`时，他会去找你写在`soruce`中的`tags`文件夹
找到其中的`layout`来进行文件匹配，如果你的`layout`是`tags` 他就会匹配到 `tags.ejs`文件
如果没有设置`layout`又不是默认的这些。那么就会进入到`/:else`中

弄懂这个有什么用呢？
那当然有用啊。。这样你随意用`hexo new page xxx`在`source`中生成一个文件，只要配置了`layout`，然后主题中写了对应的名称的文件。那么你就能diy页面了。开不开森
<img src="xianyu.gif" style="margin: 0;">

那么接下来还有最后一个问题

## git部署的email和name的问题
问题还是上面说的 我想要当前部署的git的name和email是我配置的而不是直接引用全局
我去查了一下官方文档，文档内容如下图
![hexo官网文档的git配置](hexo_git.png)

他并没有写关于`email`和`name`的问题，然后我就去翻了`hexo-deployer-git`的源码，如果他没写，我都打算要pr了，但是实际上是可以配置的。

但是我配置好了`email`和`name`之后 推上去之后依旧用的全局的`eamil`和`name`
我又仔细看了看源码然后才解决

我们来简单看看源码里面到底怎么写的

![setup部分](hexo_git_setup.png)

这里我们能看到其实是设置了username和user.eamil的

![.deploy_git文件是否存在](hexo_git_exist.png)

这里可以看到如果`deployDir`这个路径的文件夹是 存在 的话就会调用`setup`方法，即之前看到的设置`name`和`email`的方法

![deployDir文件夹路径](hexo_git_deploy.png)
这里我们看到了`deployDir`路径实际上指的是`.deploy_git`文件夹

那么答案就呼之欲出了
因为之前存在`.deploy_git`文件夹 所以并没有调用`setup`方法 从而导致并没有设置`name`和`email`
然后把`.deploy_git`文件夹删掉。再部署的话问题就结局了。。emmm

# 结语
如果大家有啥问题的话欢迎留言。以上就是我最近撸魔改代码遇到的一些坑以及解决思路。
其实本来还想说说在`windows`上使用`rsync`来部署代码的
但是呢。那是我很早就配置好的东西。。具体步骤我也忘了。当时也没有记下来，等到下次在我自己的电脑上再配置一遍的时候看能不能再写一篇。emm.
